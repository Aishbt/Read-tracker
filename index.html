<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Read & Grow</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4E9468">

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Inter',sans-serif;
  background:linear-gradient(180deg,#fff,#faf7f2);
  color:#1a1714;
}
.page{max-width:390px;margin:auto;padding:40px 20px 80px}
h1{font-family:'Playfair Display',serif;font-size:1.8rem}
em{color:#4e9468}

.streak{
  background:#ffecc2;
  padding:7px 14px;
  border-radius:999px;
  font-size:.75rem;
  font-weight:700;
  margin-bottom:4px;
}

.freeze{
  font-size:.7rem;
  color:#5c5650;
  margin-bottom:10px;
}

.plant-wrap{text-align:center;margin:28px 0}
#plantEl{font-size:2.8rem}
.plant-msg{font-style:italic;font-size:.75rem;color:#666}

.cal{
  background:#fff;
  border-radius:20px;
  padding:16px;
}
.dgrid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.d{
  aspect-ratio:1;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:12px;
  font-weight:600;
}
.today{background:#fff3d6;cursor:pointer}
.done{background:#d8f0e2}
.missed{background:#eee}
.future{opacity:.3}
.frozen{
  background:#e6f0ff;
  position:relative;
}
.frozen::after{
  content:"â„ï¸";
  position:absolute;
  font-size:.7rem;
  bottom:2px;
  right:3px;
}
button{
  margin-top:8px;
  padding:6px 10px;
  font-size:.7rem;
  border:none;
  border-radius:12px;
  background:#e6f0ff;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="page">
  <h1>Read <em>&</em> Grow</h1>
  <div class="streak" id="streak">ğŸŒ¿ 0 days</div>
  <div class="freeze" id="freeze">â„ï¸ 0</div>

  <div class="plant-wrap">
    <div id="plantEl">ğŸŒ±</div>
    <div class="plant-msg">Show up daily.</div>
  </div>

  <div class="cal">
    <div class="dgrid" id="grid"></div>
  </div>

  <button id="useFreezeBtn" style="display:none;">Use â„ï¸ Freeze</button>
</div>

<script>
const N=new Date(),Y=N.getFullYear(),M=N.getMonth(),D=N.getDate();
const daysInMonth=(y,m)=>new Date(y,m+1,0).getDate();
const firstDay=(y,m)=>new Date(y,m,1).getDay();

// ğŸ‘‡ Start date logic (Feb only)
const START_DAY = (M===1) ? 17 : 1;

const key=`rg_${Y}_${M}`;
const metaKey="rg_meta";

const loadDays=()=>JSON.parse(localStorage.getItem(key)||"{}");
const saveDays=d=>localStorage.setItem(key,JSON.stringify(d));

const loadMeta=()=>JSON.parse(localStorage.getItem(metaKey)||`{
  "streak":0,
  "growth":0,
  "freezes":0,
  "lastDay":null
}`);
const saveMeta=m=>localStorage.setItem(metaKey,JSON.stringify(m));

const growthStages=["ğŸŒ±","ğŸŒ¿","ğŸŒ¿","ğŸŒ¿","ğŸŒ¼","ğŸŒ¸","ğŸŒº","ğŸŒ·"];
const finalFlower="ğŸŒ¸";

let pendingMissDay=null;

function render(){
  const data=loadDays();
  const meta=loadMeta();
  const grid=document.getElementById("grid");
  grid.innerHTML="";
  pendingMissDay=null;

  let eligible=0;
  let completed=0;

  for(let i=0;i<firstDay(Y,M);i++) grid.appendChild(document.createElement("div"));

  for(let d=1;d<=daysInMonth(Y,M);d++){
    const c=document.createElement("div");

    if(d < START_DAY || d > D){
      c.className="d future";
      c.textContent=d;
    }else{
      eligible++;
      if(data[d]==="done"){
        completed++;
        c.className="d done";
      }else{
        if(d < D && meta.lastDay === d-1){
          pendingMissDay=d;
        }
        c.className="d missed";
      }
      c.textContent=d;
    }

    if(d===D && !data[d]){
      c.className="d today";
      c.onclick=()=>{
        data[d]="done";
        meta.streak++;
        meta.growth++;
        meta.lastDay=d;

        if(meta.streak % 5 === 0){
          meta.freezes++;
        }

        saveDays(data);
        saveMeta(meta);
        render();
      };
    }

    grid.appendChild(c);
  }

  // Growth
  let stage=Math.min(meta.growth,growthStages.length-1);
  document.getElementById("plantEl").textContent=growthStages[stage];

  // Final bloom
  if(D===daysInMonth(Y,M) && completed===eligible){
    document.getElementById("plantEl").textContent=finalFlower;
  }

  // UI
  document.getElementById("streak").textContent =
    meta.streak ? `ğŸ”¥ ${meta.streak} days` : "ğŸŒ¿ 0 days";

  document.getElementById("freeze").textContent =
    `â„ï¸ ${meta.freezes}`;

  const btn=document.getElementById("useFreezeBtn");
  if(pendingMissDay && meta.freezes>0){
    btn.style.display="block";
    btn.onclick=()=>{
      meta.freezes--;
      meta.lastDay=pendingMissDay;
      saveMeta(meta);
      render();
    };
  }else{
    btn.style.display="none";
  }
}

render();
</script>
</body>
</html>